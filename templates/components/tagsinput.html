<div class="mb-4">
  <style>
    .tags-input-container {
      display: flex;
      flex-wrap: wrap;
    }
    .autocomplete-suggestions {
      position: relative;
      background: white;
      z-index: 10;
    }
  </style>

  <div class="mb-4">
    <label class="inline-flex items-center">
      <input
        type="radio"
        name="tag-set"
        value="domains"
        class="form-radio"
        checked
      />
      <span class="ml-2">Domínios</span>
    </label>
    <label class="inline-flex items-center ml-4">
      <input
        type="radio"
        name="tag-set"
        value="users"
        class="form-radio"
      />
      <span class="ml-2">Usuários</span>
    </label>
  </div>

  <div
    class="tags-input-container border border-gray-300 p-2 rounded w-full bg-white"
    id="tags-input-container"
  >
    <input
      type="text"
      class="border-none w-full outline-none flex-1"
      id="tags-input"
      placeholder="Adicione domínios"
    />
  </div>
  <div
    class="autocomplete-suggestions border border-gray-300 rounded w-full mt-1"
    id="autocomplete-suggestions"
  ></div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const input = document.getElementById("tags-input");
      const container = document.getElementById("tags-input-container");
      const suggestionsBox = document.getElementById(
        "autocomplete-suggestions"
      );

      content = document.getElementById("domains");

      let tags = [];
      let availableTags = {
        default: [
        "JavaScript",
        "Python",
        "Django",
        "Flask",
        "HTML",
        "CSS",
        "React",
        "Vue",
        "Angular",
        "Node.js",
      ],
        domains: {{ domains|safe }},
        users: {{ users|safe }}
      }

      currentTags = {{ domains|safe }}

      function createTagElement(tag) {
        const tagElement = document.createElement("div");
        tagElement.className =
          "tag bg-gray-200 rounded px-2 py-1 m-1 flex items-center";
        tagElement.innerHTML = `<span class="mr-2">${tag}</span><button type="button" class="text-red-500" onclick="removeTag('${tag}')">&times;</button>`;
        return tagElement;
      }

      function removeTag(tag) {
        tags = tags.filter((t) => t !== tag);
        content.value = tags.join("\n");
        renderTags();
      }

      function renderTags() {
        container.innerHTML = "";
        tags.forEach((tag) => {
          const tagElement = createTagElement(tag);
          container.appendChild(tagElement);
        });
        container.appendChild(input);
        content.value = tags.join("\n");
      }

      function showSuggestions(suggestions) {
        suggestionsBox.innerHTML = "";
        suggestions.forEach((suggestion) => {
          const suggestionElement = document.createElement("div");
          suggestionElement.className = "p-2 cursor-pointer hover:bg-gray-200";
          suggestionElement.textContent = suggestion;
          suggestionElement.addEventListener("click", () => {
            if (!tags.includes(suggestion)) {
              tags.push(suggestion);
              renderTags();
            }
            input.value = "";
            suggestionsBox.innerHTML = "";
          });
          suggestionsBox.appendChild(suggestionElement);
        });
      }

      input.addEventListener("input", function () {
        const query = input.value.toLowerCase();
        if (query) {
          const filteredTags = currentTags.filter((tag) =>
            tag.toLowerCase().includes(query)
          );
          showSuggestions(filteredTags);
        } else {
          suggestionsBox.innerHTML = "";
        }
      });

      input.addEventListener("keydown", function (event) {
        if (event.key === "Enter" && input.value) {
          event.preventDefault();
          const newTag = input.value.trim();
          if (newTag && !tags.includes(newTag)) {
            tags.push(newTag);
            renderTags();
          }
          input.value = "";
          suggestionsBox.innerHTML = "";
        }
      });

      document.querySelectorAll('input[name="tag-set"]').forEach(radio => {
                radio.addEventListener('change', function () {
                    currentTags = availableTags[this.value];
                    suggestionsBox.innerHTML = '';
                    input.value = '';
                    tags = [];
                    renderTags();
                });
            });

      

      window.removeTag = removeTag;
    });
  </script>
</div>
